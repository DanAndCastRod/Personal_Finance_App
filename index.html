<!doctype html>
<html lang="en">

<head>
    <title>Finanzas personales</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link rel="stylesheet" href="./styles/styles.css">
    <link rel="stylesheet" href="./styles/bootstrap.min.css">
    <link rel="stylesheet" href="./styles/bootstrap-icons.css">
    <link rel="stylesheet" href="./styles/fontawesome.min.css">
    <link rel="stylesheet" href="./styles/material-components-web.min.css">
    <link rel="stylesheet" href="./styles/icon.css">
    <link rel="stylesheet" href="./styles/pe7sicons.css">
    <link rel="stylesheet" href="./styles/all.min.css">
    <link rel="shortcut icon" href="./img/1Recurso 1.png" type="image/x-icon">
    <script type="module" src="https://cdn.jsdelivr.net/npm/ionicons/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://cdn.jsdelivr.net/npm/ionicons/dist/ionicons/ionicons.js"></script>
    <style>
        /* Animación para deslizar desde la izquierda */
        @keyframes slideIn {
            from {
                transform: translateX(-100%);
            }

            to {
                transform: translateX(0);
            }
        }

        /* Animación para deslizar hacia la izquierda */
        @keyframes slideOut {
            from {
                transform: translateX(0);
            }

            to {
                transform: translateX(-100%);
            }
        }

        /* Clases para aplicar las animaciones */
        .animate-slide-in {
            animation: slideIn 0.5s forwards;
        }

        .animate-slide-out {
            animation: slideOut 0.5s forwards;
        }

        @media (min-width:576px) {
            .aside-class {
                color: black;
                background-color: var(--gb-light);
                width: 235px;
                position: static;
                height: 91vh;
                ;
            }
        }

        .container_tab {
            max-width: 1500px;
            margin: 0px auto;
        }

        .table_gb {
            margin-top: 1rem;
            width: 100%;
            /* Asegura que la tabla use todo el ancho disponible */
            overflow-x: auto;
            /* Permite el desplazamiento horizontal si es necesario */

        }

        .table_col {}

        /* Ajustes para pantallas más pequeñas */
        @media (max-width: 768px) {
            .table_row {
                flex-direction: column;
                /* Cambia las filas a columnas en pantallas pequeñas */
            }

            .table_col {
                width: 100%;
                /* Hace que cada columna use todo el ancho disponible */
                min-width: auto;
                /* Elimina el ancho mínimo en pantallas pequeñas */
                height: auto;
                /* Ajusta la altura automáticamente */
                padding: 0.5rem;
                /* Reduce el relleno para pantallas más pequeñas */
            }

            .table_header .table_col {
                font-weight: bold;
                /* Hace que los encabezados sean más visibles */
                text-align: left;
                /* Alinea el texto a la izquierda */
            }
        }

        .table_row {
            display: flex;
            flex-wrap: wrap;
        }

        .table_col {

            flex: 1;
            /* Hace que cada columna use una fracción igual del ancho disponible */
            min-width: 200px;
            /* Define un ancho mínimo para cada columna */
            height: 72px;
            padding-left: 1rem;
            align-content: center;
            display: flex;
            align-items: center;
            /* Centra verticalmente el contenido */

        }

        .table_header {
            background-color: var(--gb-gray-400);
            border-radius: 8px 8px 0px 0px;


        }

        .table_header .table_col {
            padding-left: 1rem;
            align-content: center;
            height: 2rem;
        }

        .table_body .table_row {
            border-width: 2px;
            border-style: solid;
            border-color: transparent rgb(229, 232, 237) rgb(229, 232, 237);
            background-color: var(--gb-light);
        }

        /* bg-light text-black w-64 space-y-6 absolute inset-y-0  */
    </style>
</head>



<body>
    <div class="app-container app-theme-white">
        <header>
            <navbarGB></navbarGB>
        </header>
        <div class="app-main">
            <sidebarGB></sidebarGB>
            <div class="app-main__outer">

                <div class=" mt-3 col-2">
                    <app-search-box><div class="search-wrapper"><div class="input-holder"><input type="text" placeholder="Type to search" class="search-input"><button class="search-icon"><span></span></button></div><button class="close"></button></div></app-search-box>
                </div>
                <div class="container align-self-center row">
                    <div class="col-md-6 mt-3">
                        <div class="card">
                            <!-- <div class="card-header">Total Disponible</div> -->
                            <div class="card-body">
                                <h4 class="card-title h1 "id="total_disponible">$00.00</h4>
                                <p class="card-text">Total Disponible</p>
                            </div>
                            <div class="card-footer text-muted">
                                <a href="./gastos_diarios.html" class="btn btn-sm btn-outline-secondary">Ver Cuentas</a>
                            </div>
                        </div>
                            
                    </div>
                    <div class="col-md-6 mt-3">
                        <div class="card">
                            <!-- <div class="card-header" >Total Presupuesto</div> -->
                            <div class="card-body">
                                <h4 class="card-title h1 " id = "total_presupuesto">$00.00</h4>
                                <p class="card-text">Total Presupuestado</p>
                            </div>
                            <div class="card-footer text-muted">
                                <a href="./presupuesto.html" class="btn btn-sm btn-outline-secondary">Ver Cuentas</a>
                            </div>
                        </div>
                        
                    </div>
                </div>



            </div>
        </div>


        <drawerGB></drawerGB>
    </div>
    <script src="./scripts/components.js"></script>
    <script src="./scripts/script.js"></script>
    <script src="./scripts/jquery.min.js"></script>
    <script src="./scripts/popper.min.js"></script>
    <script src="./scripts/bootstrap.min.js"></script>
    <script>
    </script>

    

    <script>
        function get_frecuencia(elm){
                var frecuencias;
                switch(elm.periodo){
                    case 'Semanal':
                        frecuencias = ['L','M','X','J','V','S','D']
                        break
                    case 'Quincenal':
                        frecuencias = ['Primera Quincena','Segunda Quincena']
                        break
                    default:
                        frecuencias = []
                }
                return frecuencias

            }
        userdata = JSON.parse(localStorage.data)
        fetch(`https://144.126.218.214:1880/get_cuentas/${userdata.id_usuario}`)
        .then(response=>response.json())
        .then(response=>{
            cuentas_data = response
            console.log(response)
            var saldo = 0;
            cuentas_data.forEach(acu=>{ 
                saldo+=(acu.saldo)
            })
            total_disponible.innerText = '$'+saldo.toLocaleString()
            fetch(`https://144.126.218.214:1880/get_presupuestos/${userdata.id_usuario}`)
            .then(response=> response.json())
            .then(response=>{
                presupuesto_data = response
                fetch('https://144.126.218.214:1880/get_presupuestos_detalles/')
                .then(response2=> response2.json())
                .then(reg=> {
                    Reg = reg
                    
                    
                    response.forEach(e => {
                        monto = 0
                        ejecutado = 0
                        Reg.filter(f=>f.id_presupuesto==e.id_presupuesto).forEach(k=>{
                            monto+=k.monto
                            ejecutado+= k.checked==1?k.monto:0
                        })
                        e.total = monto
                        e.ejecutado = ejecutado
                        frecuencias = get_frecuencia(e)
                        e.n_freq = e.periodo == 'Mensual' ? e.frecuencia: e.frecuencia == 'null'?'': frecuencias[e.frecuencia-1]
                    })
                        
                    
                    preps = response
                    var presupuesto = preps.reduce((acc,act)=>acc.total+act.total)
                    total_presupuesto.innerText = '$'+presupuesto.toLocaleString()
                })
            })
            
        })
        function toggleMenu() {
            if ($('#aside_menu').hasClass('d-none')) {
                // Si el menú está oculto, mostrar con animación
                $('#aside_menu').removeClass('d-none animate-slide-out').addClass('animate-slide-in');
            } else {
                // Si el menú está visible, ocultar con animación
                $('#aside_menu').removeClass('animate-slide-in').addClass('animate-slide-out');

                // Después de que la animación termine, añadir d-none
                setTimeout(function () {
                    $('#aside_menu').addClass('d-none');
                }, 500); // El tiempo aquí debe coincidir con la duración de la animación
            }
        }
        home_btn.classList.add('mm-active')
    </script>
</body>

</html>